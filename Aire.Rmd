---
title: 'Análisis calidad del aire Madrid'
author: "Autor: Sergio Romero Córdoba"
date: "Marzo 2022"
output:
  html_document:
    highlight: default
    number_sections: yes
    theme: cosmo
    toc: yes
    toc_depth: 2
  word_document: default
  pdf_document:
    highlight: zenburn
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Estudio de la calidad del aire en Madrid

```{r message= FALSE, warning=FALSE}

library(dplyr)
library(tidyr)
library(tidyverse)
library(lubridate)
library(ggplot2)

```

## Análisis y acondicionado de juego de datos de calidad del aire

### Carga y limpieza del juego de datos diraios de calidad del aire

Cargamos en primer lugar el conjunto de datos diarios de calidad del aire y vemos su estructura.

```{r message= FALSE, warning=FALSE}

mydir = "Datos diarios"
myFiles = list.files(path = mydir, pattern = "*.csv", full.names = TRUE)
datos_diarios_aire <- lapply(myFiles, read_csv2) %>% bind_rows()
str(datos_diarios_aire)

```

Cada registro está estructurado de la siguiente forma:

PROVINCIA, MUNICIPIO, ESTACION, MAGNITUD, PUNTO_MUESTREO, ANO, MES, D01, V01, D02, V02...

Donde D01 corresponde al dato del primer día del mes, D02 al del segundo día y así sucesivamente.

Vamos a ver ahora los distintos valores para la columna MAGNITUD. Estos valores nos identifican los distintos datos que se miden en cada una de las estaciones:

```{r message= FALSE, warning=FALSE}

distinct(datos_diarios_aire, MAGNITUD)

```

En la definición del conjunto de datos encontramos los tipos de contaminantes que corresponden a cada uno de estos códigos:

```{r table1, echo=FALSE, message=FALSE, warnings=FALSE, results='asis'}

cat("
| ID    | Nombre contaminante                 | Código  |
|-------|:------------------------------------|:--------|
| 01    | Dióxido de Azufre                   | SO2     |
| 06    | Monóxido de Carbono                 | CO      |
| 07    | Monóxido de Nitrógeno               | NO      |
| 08    | Dióxido de Nitrógeno                | NO2     |
| 09    | Partículas < 2.5 µm                 | PM2.5   |
| 10    | Partículas < 10 µm                  | PM10    |
| 12    | Óxidos de Nitrógeno                 | NOx     |
| 14    | Ozono                               | O3      |
| 20    | Tolueno                             | TOL     |
| 30    | Benceno                             | BEN     |
| 35    | Etilbenceno                         | EBE     |
| 37    | Metaxileno                          | MXY     |
| 38    | Paraxileno                          | PXY     |
| 39    | Ortoxileno                          | OXY     |
| 42    | Hidrocarburos totales (hexano)      | TCH     |
| 43    | Metano                              | CH4     |
| 44    | Hidrocarburos no metánicos (hexano) | NMHC    |
")

```

Se puede encontrar más detalle de cada uno de los tipos de contaminantes en el portal web de calidad del aire del ayuntamiento de Madrid (http://www.mambiente.madrid.es/opencms/opencms/calaire/ContAtmosferica/Contaminantes/Tipos.html).

Las columnas Vx identifican los valores que han sido validados. Vamos a limpiar en primer lugar los datos no validados.

```{r message= FALSE, warning=FALSE}

datos_diarios_aire$D01 <- ifelse(datos_diarios_aire$V01 == "N", NA, datos_diarios_aire$D01)
datos_diarios_aire$D02 <- ifelse(datos_diarios_aire$V02 == "N", NA, datos_diarios_aire$D02)
datos_diarios_aire$D03 <- ifelse(datos_diarios_aire$V03 == "N", NA, datos_diarios_aire$D03)
datos_diarios_aire$D04 <- ifelse(datos_diarios_aire$V04 == "N", NA, datos_diarios_aire$D04)
datos_diarios_aire$D05 <- ifelse(datos_diarios_aire$V05 == "N", NA, datos_diarios_aire$D05)
datos_diarios_aire$D06 <- ifelse(datos_diarios_aire$V06 == "N", NA, datos_diarios_aire$D06)
datos_diarios_aire$D07 <- ifelse(datos_diarios_aire$V07 == "N", NA, datos_diarios_aire$D07)
datos_diarios_aire$D08 <- ifelse(datos_diarios_aire$V08 == "N", NA, datos_diarios_aire$D08)
datos_diarios_aire$D09 <- ifelse(datos_diarios_aire$V09 == "N", NA, datos_diarios_aire$D09)
datos_diarios_aire$D10 <- ifelse(datos_diarios_aire$V10 == "N", NA, datos_diarios_aire$D10)
datos_diarios_aire$D11 <- ifelse(datos_diarios_aire$V11 == "N", NA, datos_diarios_aire$D11)
datos_diarios_aire$D12 <- ifelse(datos_diarios_aire$V12 == "N", NA, datos_diarios_aire$D12)
datos_diarios_aire$D13 <- ifelse(datos_diarios_aire$V13 == "N", NA, datos_diarios_aire$D13)
datos_diarios_aire$D14 <- ifelse(datos_diarios_aire$V14 == "N", NA, datos_diarios_aire$D14)
datos_diarios_aire$D15 <- ifelse(datos_diarios_aire$V15 == "N", NA, datos_diarios_aire$D15)
datos_diarios_aire$D16 <- ifelse(datos_diarios_aire$V16 == "N", NA, datos_diarios_aire$D16)
datos_diarios_aire$D17 <- ifelse(datos_diarios_aire$V17 == "N", NA, datos_diarios_aire$D17)
datos_diarios_aire$D18 <- ifelse(datos_diarios_aire$V18 == "N", NA, datos_diarios_aire$D18)
datos_diarios_aire$D19 <- ifelse(datos_diarios_aire$V19 == "N", NA, datos_diarios_aire$D19)
datos_diarios_aire$D20 <- ifelse(datos_diarios_aire$V20 == "N", NA, datos_diarios_aire$D20)
datos_diarios_aire$D21 <- ifelse(datos_diarios_aire$V21 == "N", NA, datos_diarios_aire$D21)
datos_diarios_aire$D22 <- ifelse(datos_diarios_aire$V22 == "N", NA, datos_diarios_aire$D22)
datos_diarios_aire$D23 <- ifelse(datos_diarios_aire$V23 == "N", NA, datos_diarios_aire$D23)
datos_diarios_aire$D24 <- ifelse(datos_diarios_aire$V24 == "N", NA, datos_diarios_aire$D24)
datos_diarios_aire$D25 <- ifelse(datos_diarios_aire$V25 == "N", NA, datos_diarios_aire$D25)
datos_diarios_aire$D26 <- ifelse(datos_diarios_aire$V26 == "N", NA, datos_diarios_aire$D26)
datos_diarios_aire$D27 <- ifelse(datos_diarios_aire$V27 == "N", NA, datos_diarios_aire$D27)
datos_diarios_aire$D28 <- ifelse(datos_diarios_aire$V28 == "N", NA, datos_diarios_aire$D28)
datos_diarios_aire$D29 <- ifelse(datos_diarios_aire$V29 == "N", NA, datos_diarios_aire$D29)
datos_diarios_aire$D30 <- ifelse(datos_diarios_aire$V30 == "N", NA, datos_diarios_aire$D30)
datos_diarios_aire$D31 <- ifelse(datos_diarios_aire$V31 == "N", NA, datos_diarios_aire$D31)


```


Vamos a eliminar algunas de las columnas que no nos aportan información:

- Las columnas Vx

- Las columnas PROVINCIA, MUNICIPIO y PUNTO_MUESTREO no aportan información ya que se trata para todos los casos de estaciones de Madrid y el punto de muestreo es una combinación de los valores de provincia, municipio y estación.

```{r message= FALSE, warning=FALSE}

datos_diarios_aire <- datos_diarios_aire[, -grep("^V", colnames(datos_diarios_aire))]
datos_diarios_aire <- subset(datos_diarios_aire, select = -c(PROVINCIA, MUNICIPIO, PUNTO_MUESTREO))

```

A continuación, reorganizamos nuestro dataframe de manera que las distintas magnitudes se muestren como columnas, mientras que los días pasaran a ser filas (cada fila corresponderá a un día).

```{r message= FALSE, warning=FALSE}

datos_diarios_aire <- datos_diarios_aire %>%
  gather("DIA", "VALOR", D01:D31) %>%
  spread(key = MAGNITUD, value = "VALOR")

```

Vamos a quedarnos con un pequeño grupo de contaminantes. Este grupo se ha escogido en base al índice de calidad del aire (ICA) creado por la Agencia Europea de Medio Ambiente (AEMA). El ICA se basa en cinco contaminantes clave que son perjudiciales para la salud de las personas y el medioambiente: partículas en suspensión (PM2,5 y PM10), ozono troposférico (O3), dióxido de nitrógeno (NO2) y dióxido de azufre (SO2). Los detalles sobre el ICA se pueden encontrar en la página web de la AEMA (https://www.eea.europa.eu/es/highlights/indice-europeo-de-calidad-del).


```{r message= FALSE, warning=FALSE}

#datos_diarios_aire$FECHA <- as.Date(with(datos_diarios_aire, paste(ANO, MES, substring(DIA, 2), sep="-")), "%Y-%m-%d")
#datos_diarios_aire <- datos_diarios_aire[,c(1, 5, 8:10, 12, 19)]
datos_diarios_aire <- datos_diarios_aire[,c(1:5, 8:10, 12)]

```

Por último, cambiamos el nombre de las columnas para poner un nombre significativo, convertimos las columnas con los valores de los contaminantes a tipo numeric y factorizamos las columnas de año y estación.

```{r message= FALSE, warning=FALSE}

colnames(datos_diarios_aire) <- c("ESTACION", "ANO", "MES", "DIA", "SO2", "NO2", "PM25", "PM10", "O3")

datos_diarios_aire$SO2 <- as.numeric(datos_diarios_aire$SO2)
datos_diarios_aire$NO2 <- as.numeric(datos_diarios_aire$NO2)
datos_diarios_aire$PM25 <- as.numeric(datos_diarios_aire$PM25)
datos_diarios_aire$PM10 <- as.numeric(datos_diarios_aire$PM10)
datos_diarios_aire$O3 <- as.numeric(datos_diarios_aire$O3)

#datos_diarios_aire$ANO <- as.factor(datos_diarios_aire$ANO)
#datos_diarios_aire$ESTACION <- as.factor(datos_diarios_aire$ESTACION)

summary(datos_diarios_aire)

```


### Carga de juego de datos con información de estaciones

Cargamos el conjunto de datos con informaciones de las estaciones de control y vemos su estructura.

```{r message= FALSE, warning=FALSE}

datos_estaciones_aire <- read_csv2("Estaciones/informacion_estaciones_red_calidad_aire.csv")
str(datos_estaciones_aire)

```

Vamos a obviar la información geográfica para el análisis en R y vamos a quedarnos únicamente con el nombre y el tipo de estación.

```{r message= FALSE, warning=FALSE}

datos_estaciones_aire <- datos_estaciones_aire[,c("CODIGO_CORTO", "ESTACION", "NOM_TIPO")]

```

Añadimos esta información al conjunto de datos diarios de calidad del aire.

```{r message= FALSE, warning=FALSE}

datos_diarios_aire <- merge(x = datos_diarios_aire, y = datos_estaciones_aire, by.x = "ESTACION", by.y = "CODIGO_CORTO", all = TRUE)
colnames(datos_diarios_aire)[10] <- "NOM_ESTACION"

```

### Análisis de datos de calidad del aire

Outliers

```{r message= FALSE, warning=FALSE}

ggplot(datos_diarios_aire, aes(y = SO2)) +
  geom_boxplot(width = 0.4) +
  ggtitle("  SO2") +
  theme_bw() +
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 40, b = -20))) + 
  labs(y = bquote(μg / m^3))

ggplot(datos_diarios_aire, aes(y = NO2)) +
  geom_boxplot(width = 0.4) +
  ggtitle("  NO2") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 40, b = -20))) + 
  labs(y = bquote(μg / m^3))

ggplot(datos_diarios_aire, aes(y = PM10)) +
  geom_boxplot(width = 0.4) +
  ggtitle("  PM10") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 40, b = -20))) + 
  labs(y = bquote(μg / m^3))

ggplot(datos_diarios_aire, aes(y = PM25)) +
  geom_boxplot(width = 0.4) +
  ggtitle("  PM25") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 40, b = -20))) + 
  labs(y = bquote(μg / m^3))

ggplot(datos_diarios_aire, aes(y = O3)) +
  geom_boxplot(width = 0.4) +
  ggtitle("  O3") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 40, b = -20))) + 
  labs(y = bquote(μg / m^3))

```

Evolución anual

```{r message= FALSE, warning=FALSE}

require(plyr)

DF = ddply(datos_diarios_aire, c("ANO"), summarize, SO2.mean = mean(SO2, na.rm = T))

ggplot(DF, aes(x = ANO, y = SO2.mean)) +
  geom_line(size = 1, color="blue") 
#  stat_smooth(color = "red", fill = "red", method = "loess" ) 
#  theme_bw() + 
#  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 40, b = -20))) + 
#  labs(x = "Año", y = bquote(μg / m^3))

```

```{r message= FALSE, warning=FALSE}

ggplot(datos_diarios_aire, aes(x = ANO, y = SO2)) +
  geom_boxplot(width = 0.4, color="black", fill="blue", alpha=0.7) +
  scale_y_continuous(limits = quantile(datos_diarios_aire$SO2, c(0.1, 0.9), na.rm = TRUE)) +
  stat_summary(fun = median, geom = 'line', aes(group = 'SO2'), color = 'black') +
  ggtitle("  SO2") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 40, b = -20))) + 
  labs(x = "Año", y = bquote(μg / m^3))

ggplot(datos_diarios_aire, aes(x = ANO, y = NO2)) +
  geom_boxplot(width = 0.4, color="black", fill="red", alpha=0.7) +
  scale_y_continuous(limits = quantile(datos_diarios_aire$NO2, c(0.1, 0.9), na.rm = TRUE)) +
  stat_summary(fun = median, geom = 'line', aes(group = 'NO2'), color = 'black') +
  ggtitle("  NO2") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 40, b = -20))) + 
  labs(x = "Año", y = bquote(μg / m^3))

ggplot(datos_diarios_aire, aes(x = ANO, y = PM10)) +
  geom_boxplot(width = 0.4, color="black", fill="orange", alpha=0.7) +
  scale_y_continuous(limits = quantile(datos_diarios_aire$PM10, c(0.1, 0.9), na.rm = TRUE)) +
  stat_summary(fun = median, geom = 'line', aes(group = 'PM10'), color = 'black') +
  ggtitle("  PM10") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 40, b = -20))) + 
  labs(x = "Año", y = bquote(μg / m^3))

ggplot(datos_diarios_aire, aes(x = ANO, y = PM25)) +
  geom_boxplot(width = 0.4, color="black", fill="green", alpha=0.7) +
  scale_y_continuous(limits = quantile(datos_diarios_aire$PM25, c(0.1, 0.9), na.rm = TRUE)) +
  stat_summary(fun = median, geom = 'line', aes(group = 'PM25'), color = 'black') +
  ggtitle("  PM25") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 40, b = -20))) + 
  labs(x = "Año", y = bquote(μg / m^3))

ggplot(datos_diarios_aire, aes(x = ANO, y = O3)) +
  geom_boxplot(width = 0.4, color="black", fill="gray", alpha=0.7) +
  scale_y_continuous(limits = quantile(datos_diarios_aire$O3, c(0.1, 0.9), na.rm = TRUE)) +
  stat_summary(fun = median, geom = 'line', aes(group = 'O3'), color = 'black') +
  ggtitle("  O3") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 40, b = -20))) + 
  labs(x = "Año", y = bquote(μg / m^3))

```

Distribución por estaciones

```{r message= FALSE, warning=FALSE}

ggplot(datos_diarios_aire, aes(x = ESTACION, y = SO2)) +
  geom_boxplot(width = 0.4, color="black", fill="blue", alpha=0.7) +
  scale_y_continuous(limits = quantile(datos_diarios_aire$SO2, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  SO2") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 40, b = -20))) + 
  labs(x = "Estación", y = bquote(μg / m^3))

ggplot(datos_diarios_aire, aes(x = ESTACION, y = NO2)) +
  geom_boxplot(width = 0.4, color="black", fill="red", alpha=0.7) +
  scale_y_continuous(limits = quantile(datos_diarios_aire$NO2, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  NO2") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 40, b = -20))) + 
  labs(x = "Estación", y = bquote(μg / m^3))

ggplot(datos_diarios_aire, aes(x = ESTACION, y = PM10)) +
  geom_boxplot(width = 0.4, color="black", fill="orange", alpha=0.7) +
  scale_y_continuous(limits = quantile(datos_diarios_aire$PM10, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  PM10") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 40, b = -20))) + 
  labs(x = "Estación", y = bquote(μg / m^3))

ggplot(datos_diarios_aire, aes(x = ESTACION, y = PM25)) +
  geom_boxplot(width = 0.4, color="black", fill="green", alpha=0.7) +
  scale_y_continuous(limits = quantile(datos_diarios_aire$PM25, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  PM25") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 40, b = -20))) + 
  labs(x = "Estación", y = bquote(μg / m^3))

ggplot(datos_diarios_aire, aes(x = ESTACION, y = O3)) +
  geom_boxplot(width = 0.4, color="black", fill="gray", alpha=0.7) +
  scale_y_continuous(limits = quantile(datos_diarios_aire$O3, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  O3") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 40, b = -20))) + 
  labs(x = "Estación", y = bquote(μg / m^3))

```

Distribución por tipo de estación

```{r message= FALSE, warning=FALSE}

ggplot(datos_diarios_aire, aes(x = NOM_TIPO, y = SO2)) +
  geom_boxplot(width = 0.4, color="black", fill="blue", alpha=0.7) +
  scale_y_continuous(limits = quantile(datos_diarios_aire$SO2, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  SO2") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 40, b = -20))) + 
  labs(x = "Estación", y = bquote(μg / m^3))

ggplot(datos_diarios_aire, aes(x = NOM_TIPO, y = NO2)) +
  geom_boxplot(width = 0.4, color="black", fill="red", alpha=0.7) +
  scale_y_continuous(limits = quantile(datos_diarios_aire$NO2, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  NO2") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 40, b = -20))) + 
  labs(x = "Estación", y = bquote(μg / m^3))

ggplot(datos_diarios_aire, aes(x = NOM_TIPO, y = PM10)) +
  geom_boxplot(width = 0.4, color="black", fill="orange", alpha=0.7) +
  scale_y_continuous(limits = quantile(datos_diarios_aire$PM10, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  PM10") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 40, b = -20))) + 
  labs(x = "Estación", y = bquote(μg / m^3))

ggplot(datos_diarios_aire, aes(x = NOM_TIPO, y = PM25)) +
  geom_boxplot(width = 0.4, color="black", fill="green", alpha=0.7) +
  scale_y_continuous(limits = quantile(datos_diarios_aire$PM25, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  PM25") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 40, b = -20))) + 
  labs(x = "Estación", y = bquote(μg / m^3))

ggplot(datos_diarios_aire, aes(x = NOM_TIPO, y = O3)) +
  geom_boxplot(width = 0.4, color="black", fill="gray", alpha=0.7) +
  scale_y_continuous(limits = quantile(datos_diarios_aire$O3, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  O3") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 40, b = -20))) + 
  labs(x = "Estación", y = bquote(μg / m^3))

```








```{r message= FALSE, warning=FALSE}

write_csv(datos_diarios_aire, path = "datos_diarios_aire.csv", append = FALSE, col_names = TRUE, na = '')

```










Cargamos en primer lugar el conjunto de datos horarios de calidad del aire y vemos su estructura.

```{r message= FALSE, warning=FALSE}

mydir = "Datos horarios"
myFiles = list.files(path = mydir, pattern = "*.csv", full.names = TRUE, recursive = TRUE)
datos_horarios_aire <- myFiles %>% map_df(~read_csv2(.x) %>% mutate(MES = as.character(MES)))

```

```{r message= FALSE, warning=FALSE}

datos_horarios_aire$H01 <- ifelse(datos_horarios_aire$V01 == "N", NA, datos_horarios_aire$H01)
datos_horarios_aire$H02 <- ifelse(datos_horarios_aire$V02 == "N", NA, datos_horarios_aire$H02)
datos_horarios_aire$H03 <- ifelse(datos_horarios_aire$V03 == "N", NA, datos_horarios_aire$H03)
datos_horarios_aire$H04 <- ifelse(datos_horarios_aire$V04 == "N", NA, datos_horarios_aire$H04)
datos_horarios_aire$H05 <- ifelse(datos_horarios_aire$V05 == "N", NA, datos_horarios_aire$H05)
datos_horarios_aire$H06 <- ifelse(datos_horarios_aire$V06 == "N", NA, datos_horarios_aire$H06)
datos_horarios_aire$H07 <- ifelse(datos_horarios_aire$V07 == "N", NA, datos_horarios_aire$H07)
datos_horarios_aire$H08 <- ifelse(datos_horarios_aire$V08 == "N", NA, datos_horarios_aire$H08)
datos_horarios_aire$H09 <- ifelse(datos_horarios_aire$V09 == "N", NA, datos_horarios_aire$H09)
datos_horarios_aire$H10 <- ifelse(datos_horarios_aire$V10 == "N", NA, datos_horarios_aire$H10)
datos_horarios_aire$H11 <- ifelse(datos_horarios_aire$V11 == "N", NA, datos_horarios_aire$H11)
datos_horarios_aire$H12 <- ifelse(datos_horarios_aire$V12 == "N", NA, datos_horarios_aire$H12)
datos_horarios_aire$H13 <- ifelse(datos_horarios_aire$V13 == "N", NA, datos_horarios_aire$H13)
datos_horarios_aire$H14 <- ifelse(datos_horarios_aire$V14 == "N", NA, datos_horarios_aire$H14)
datos_horarios_aire$H15 <- ifelse(datos_horarios_aire$V15 == "N", NA, datos_horarios_aire$H15)
datos_horarios_aire$H16 <- ifelse(datos_horarios_aire$V16 == "N", NA, datos_horarios_aire$H16)
datos_horarios_aire$H17 <- ifelse(datos_horarios_aire$V17 == "N", NA, datos_horarios_aire$H17)
datos_horarios_aire$H18 <- ifelse(datos_horarios_aire$V18 == "N", NA, datos_horarios_aire$H18)
datos_horarios_aire$H19 <- ifelse(datos_horarios_aire$V19 == "N", NA, datos_horarios_aire$H19)
datos_horarios_aire$H20 <- ifelse(datos_horarios_aire$V20 == "N", NA, datos_horarios_aire$H20)
datos_horarios_aire$H21 <- ifelse(datos_horarios_aire$V21 == "N", NA, datos_horarios_aire$H21)
datos_horarios_aire$H22 <- ifelse(datos_horarios_aire$V22 == "N", NA, datos_horarios_aire$H22)
datos_horarios_aire$H23 <- ifelse(datos_horarios_aire$V23 == "N", NA, datos_horarios_aire$H23)
datos_horarios_aire$H24 <- ifelse(datos_horarios_aire$V24 == "N", NA, datos_horarios_aire$H24)

```


```{r message= FALSE, warning=FALSE}

datos_horarios_aire <- datos_horarios_aire[, -grep("^V", colnames(datos_horarios_aire))]
datos_horarios_aire <- subset(datos_horarios_aire, select = -c(PROVINCIA, MUNICIPIO, PUNTO_MUESTREO))

datos_horarios_aire <- datos_horarios_aire %>%
  gather("HORA", "VALOR", H01:H24) %>%
  spread(key = MAGNITUD, value = "VALOR")

```

```{r message= FALSE, warning=FALSE}

#datos_horarios_aire$FECHA <- make_datetime(as.integer(datos_horarios_aire$ANO), as.integer(datos_horarios_aire$MES), as.integer(substring(datos_horarios_aire$DIA, 2)), as.integer(substring(datos_horarios_aire$HORA, 2)))
datos_horarios_aire <- datos_horarios_aire[,c(1:6, 9:11, 13)]
colnames(datos_horarios_aire) <- c("ESTACION", "ANO", "MES", "DIA", "HORA", "SO2", "NO2", "PM25", "PM10", "O3")

```

```{r message= FALSE, warning=FALSE}

datos_horarios_aire$SO2 <- as.numeric(datos_horarios_aire$SO2)
datos_horarios_aire$NO2 <- as.numeric(datos_horarios_aire$NO2)
datos_horarios_aire$PM25 <- as.numeric(datos_horarios_aire$PM25)
datos_horarios_aire$PM10 <- as.numeric(datos_horarios_aire$PM10)
datos_horarios_aire$O3 <- as.numeric(datos_horarios_aire$O3)

#datos_horarios_aire$ANO <- as.factor(datos_horarios_aire$ANO)
#datos_horarios_aire$MES <- as.factor(datos_horarios_aire$MES)
#datos_horarios_aire$DIA <- as.factor(datos_horarios_aire$DIA)
#datos_horarios_aire$HORA <- as.factor(datos_horarios_aire$HORA)
#datos_horarios_aire$ESTACION <- as.factor(datos_horarios_aire$ESTACION)

summary(datos_horarios_aire)

```

```{r message= FALSE, warning=FALSE}

head(datos_horarios_aire)

```

### Carga de juego de datos con información de estaciones

Cargamos el conjunto de datos con informaciones de las estaciones de control y vemos su estructura.

```{r message= FALSE, warning=FALSE}

datos_estaciones_aire <- read_csv2("Estaciones/informacion_estaciones_red_calidad_aire.csv")
str(datos_estaciones_aire)

```

Vamos a obviar la información geográfica para el análisis en R y vamos a quedarnos únicamente con el nombre y el tipo de estación.

```{r message= FALSE, warning=FALSE}

datos_estaciones_aire <- datos_estaciones_aire[,c("CODIGO_CORTO", "ESTACION", "NOM_TIPO")]

```

Añadimos esta información al conjunto de datos horarios de calidad del aire.

```{r message= FALSE, warning=FALSE}

datos_horarios_aire <- merge(x = datos_horarios_aire, y = datos_estaciones_aire, by.x = "ESTACION", by.y = "CODIGO_CORTO", all = TRUE)
colnames(datos_horarios_aire)[11] <- "NOM_ESTACION"

```

### Análisis de datos de calidad del aire

Outliers

```{r message= FALSE, warning=FALSE}

ggplot(datos_horarios_aire, aes(y = SO2)) +
  geom_boxplot(width = 0.4) +
  ggtitle("  SO2") +
  theme_bw() +
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 40, b = -20))) + 
  labs(y = bquote(μg / m^3))

ggplot(datos_horarios_aire, aes(y = NO2)) +
  geom_boxplot(width = 0.4) +
  ggtitle("  NO2") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 40, b = -20))) + 
  labs(y = bquote(μg / m^3))

ggplot(datos_horarios_aire, aes(y = PM10)) +
  geom_boxplot(width = 0.4) +
  ggtitle("  PM10") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 40, b = -20))) + 
  labs(y = bquote(μg / m^3))

ggplot(datos_horarios_aire, aes(y = PM25)) +
  geom_boxplot(width = 0.4) +
  ggtitle("  PM25") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 40, b = -20))) + 
  labs(y = bquote(μg / m^3))

ggplot(datos_horarios_aire, aes(y = O3)) +
  geom_boxplot(width = 0.4) +
  ggtitle("  O3") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 40, b = -20))) + 
  labs(y = bquote(μg / m^3))

```

Evolución anual

["#fd7f6f", "#7eb0d5", "#b2e061", "#bd7ebe", "#ffb55a", "#ffee65", "#beb9db", "#fdcce5", "#8bd3c7"]

```{r message= FALSE, warning=FALSE}

colores <- c("#fd7f6f", "#7eb0d5", "#b2e061", "#bd7ebe", "#ffb55a")
names(colores) <- c("SO2", "NO2", "PM10", "PM25", "O3")

```

```{r message= FALSE, warning=FALSE}

DF <- ddply(datos_horarios_aire, c("ANO"), summarize, SO2.mean = mean(SO2, na.rm = T), NO2.mean = mean(NO2, na.rm = T), PM10.mean = mean(PM10, na.rm = T), PM25.mean = mean(PM25, na.rm = T), O3.mean = mean(O3, na.rm = T))

p1 <- ggplot(DF, aes(x = ANO, y = SO2.mean)) +
  geom_line(size = 0.5, color = colores["SO2"]) +
  ggtitle("  SO2") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 10, b = -20), hjust = 0.98), axis.text.x=element_blank(), axis.title.x=element_blank(), axis.ticks.x = element_blank(), panel.grid.major.y = element_blank()) + 
  labs(y = bquote(μg / m^3))

p2 <- ggplot(DF, aes(x = ANO, y = NO2.mean)) +
  geom_line(size = 0.5, color =  colores["NO2"]) +
  ggtitle("  NO2") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 10, b = -20), hjust = 0.98), axis.text.x=element_blank(), axis.title.x=element_blank(), axis.ticks.x = element_blank(), panel.grid.major.y = element_blank()) + 
  labs(y = bquote(μg / m^3))

p3 <- ggplot(DF, aes(x = ANO, y = PM10.mean)) +
  geom_line(size = 0.5, color =  colores["PM10"]) +
  ggtitle("  PM10") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 10, b = -20), hjust = 0.98), axis.text.x=element_blank(), axis.title.x=element_blank(), axis.ticks.x = element_blank(), panel.grid.major.y = element_blank()) + 
  labs(y = bquote(μg / m^3))

p4 <- ggplot(DF, aes(x = ANO, y = PM25.mean)) +
  geom_line(size = 0.5, color =  colores["PM25"]) +
  ggtitle("  PM25") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 10, b = -20), hjust = 0.98), axis.text.x=element_blank(), axis.title.x=element_blank(), axis.ticks.x = element_blank(), panel.grid.major.y = element_blank()) + 
  labs(y = bquote(μg / m^3))

p5 <- ggplot(DF, aes(x = ANO, y = O3.mean)) +
  geom_line(size = 0.5, color =  colores["O3"]) +
  ggtitle("  O3") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 10, b = -20), hjust = 0.98)) + 
  labs(x = "Año", y = bquote(μg / m^3))
```

```{r message= FALSE, warning=FALSE}
#library(cowplot)
#library(egg)
p <- plot_grid(p1, p2, p3, p4, p5, nrow = 5, rel_heights = c(1, 1, 1, 1, 1.2))
save_plot("prueba.png", p, base_width = 8, base_height = 8)
```



Distribución por estaciones

```{r message= FALSE, warning=FALSE}

p1 <- ggplot(datos_horarios_aire, aes(x = as.factor(ESTACION), y = SO2)) +
  geom_boxplot(width = 0.4, color = "black", fill = colores["SO2"], alpha = 0.7) +
  scale_y_continuous(limits = quantile(datos_horarios_aire$SO2, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  SO2") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 10, b = -20))) + 
  labs(x = "Estación", y = bquote(μg / m^3))

p2 <- ggplot(datos_horarios_aire, aes(x = as.factor(ESTACION), y = NO2)) +
  geom_boxplot(width = 0.4, color = "black", fill = colores["NO2"], alpha = 0.7) +
  scale_y_continuous(limits = quantile(datos_horarios_aire$NO2, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  NO2") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 10, b = -20))) + 
  labs(x = "Estación", y = bquote(μg / m^3))

p3 <- ggplot(datos_horarios_aire, aes(x = as.factor(ESTACION), y = PM10)) +
  geom_boxplot(width = 0.4, color = "black", fill = colores["PM10"], alpha = 0.7) +
  scale_y_continuous(limits = quantile(datos_horarios_aire$PM10, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  PM10") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 10, b = -20))) + 
  labs(x = "Estación", y = bquote(μg / m^3))

p4 <- ggplot(datos_horarios_aire, aes(x = as.factor(ESTACION), y = PM25)) +
  geom_boxplot(width = 0.4, color = "black", fill = colores["PM25"], alpha = 0.7) +
  scale_y_continuous(limits = quantile(datos_horarios_aire$PM25, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  PM25") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 10, b = -20))) + 
  labs(x = "Estación", y = bquote(μg / m^3))

p5 <- ggplot(datos_horarios_aire, aes(x = as.factor(ESTACION), y = O3)) +
  geom_boxplot(width = 0.4, color = "black", fill = colores["O3"], alpha = 0.7) +
  scale_y_continuous(limits = quantile(datos_horarios_aire$O3, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  O3") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 10, b = -20))) + 
  labs(x = "Estación", y = bquote(μg / m^3))

```

```{r message= FALSE, warning=FALSE}

p <- plot_grid(p1, p2, p3, p4, p5, ncol = 2)
save_plot("prueba2.png", p, base_width = 10, base_height = 8)

```

Distribución por tipo de estación

```{r message= FALSE, warning=FALSE}

p1 <- ggplot(datos_horarios_aire, aes(x = as.factor(NOM_TIPO), y = SO2)) +
  geom_boxplot(width = 0.4, color = "black", fill = colores["SO2"], alpha = 0.7) +
  scale_y_continuous(limits = quantile(datos_horarios_aire$SO2, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  SO2") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 10, b = -20))) + 
  labs(x = "Estación", y = bquote(μg / m^3))

p2 <- ggplot(datos_horarios_aire, aes(x = as.factor(NOM_TIPO), y = NO2)) +
  geom_boxplot(width = 0.4, color = "black", fill = colores["NO2"], alpha = 0.7) +
  scale_y_continuous(limits = quantile(datos_horarios_aire$NO2, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  NO2") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 10, b = -20))) + 
  labs(x = "Estación", y = bquote(μg / m^3))

p3 <- ggplot(datos_horarios_aire, aes(x = as.factor(NOM_TIPO), y = PM10)) +
  geom_boxplot(width = 0.4, color = "black", fill = colores["PM10"], alpha = 0.7) +
  scale_y_continuous(limits = quantile(datos_horarios_aire$PM10, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  PM10") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 10, b = -20))) + 
  labs(x = "Estación", y = bquote(μg / m^3))

p4 <- ggplot(datos_horarios_aire, aes(x = as.factor(NOM_TIPO), y = PM25)) +
  geom_boxplot(width = 0.4, color = "black", fill = colores["PM25"], alpha = 0.7) +
  scale_y_continuous(limits = quantile(datos_horarios_aire$PM25, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  PM25") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 10, b = -20))) + 
  labs(x = "Estación", y = bquote(μg / m^3))

p5 <- ggplot(datos_horarios_aire, aes(x = as.factor(NOM_TIPO), y = O3)) +
  geom_boxplot(width = 0.4, color = "black", fill = colores["O3"], alpha = 0.7) +
  scale_y_continuous(limits = quantile(datos_horarios_aire$O3, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  O3") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 10, b = -20))) + 
  labs(x = "Estación", y = bquote(μg / m^3))

```

```{r message= FALSE, warning=FALSE}

p <- plot_grid(p1, p2, p3, p4, p5, ncol = 2)
save_plot("prueba3.png", p, base_width = 10, base_height = 8)

```


Distribución mensual

```{r message= FALSE, warning=FALSE}

p1 <- ggplot(datos_horarios_aire, aes(x = as.factor(MES), y = SO2)) +
  geom_boxplot(width = 0.4, color = "black", fill = colores["SO2"], alpha = 0.7) +
  scale_y_continuous(limits = quantile(datos_horarios_aire$SO2, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  SO2") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 10, b = -20))) + 
  labs(x = "Mes", y = bquote(μg / m^3))

p2 <- ggplot(datos_horarios_aire, aes(x = as.factor(MES), y = NO2)) +
  geom_boxplot(width = 0.4, color = "black", fill = colores["NO2"], alpha = 0.7) +
  scale_y_continuous(limits = quantile(datos_horarios_aire$SO2, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  NO2") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 10, b = -20))) + 
  labs(x = "Mes", y = bquote(μg / m^3))

p3 <- ggplot(datos_horarios_aire, aes(x = as.factor(MES), y = PM10)) +
  geom_boxplot(width = 0.4, color = "black", fill = colores["PM10"], alpha = 0.7) +
  scale_y_continuous(limits = quantile(datos_horarios_aire$SO2, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  PM10") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 10, b = -20))) + 
  labs(x = "Mes", y = bquote(μg / m^3))

p4 <- ggplot(datos_horarios_aire, aes(x = as.factor(MES), y = PM25)) +
  geom_boxplot(width = 0.4, color = "black", fill = colores["PM25"], alpha = 0.7) +
  scale_y_continuous(limits = quantile(datos_horarios_aire$SO2, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  PM25") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 10, b = -20))) + 
  labs(x = "Mes", y = bquote(μg / m^3))

p5 <- ggplot(datos_horarios_aire, aes(x = as.factor(MES), y = O3)) +
  geom_boxplot(width = 0.4, color = "black", fill = colores["O3"], alpha = 0.7) +
  scale_y_continuous(limits = quantile(datos_horarios_aire$SO2, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  O3") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 10, b = -20))) + 
  labs(x = "Mes", y = bquote(μg / m^3))

```

```{r message= FALSE, warning=FALSE}

p <- plot_grid(p1, p2, p3, p4, p5, ncol = 2)
save_plot("prueba4.png", p, base_width = 10, base_height = 8)

```

Distribución horaria

```{r message= FALSE, warning=FALSE}

p1 <- ggplot(datos_horarios_aire, aes(x = as.factor(HORA), y = SO2)) +
  geom_boxplot(width = 0.4, color = "black", fill = colores["SO2"], alpha = 0.7) +
  scale_y_continuous(limits = quantile(datos_horarios_aire$SO2, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  SO2") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 10, b = -20))) + 
  labs(x = "Mes", y = bquote(μg / m^3))

p2 <- ggplot(datos_horarios_aire, aes(x = as.factor(HORA), y = NO2)) +
  geom_boxplot(width = 0.4, color = "black", fill = colores["NO2"], alpha = 0.7) +
  scale_y_continuous(limits = quantile(datos_horarios_aire$SO2, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  NO2") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 10, b = -20))) + 
  labs(x = "Mes", y = bquote(μg / m^3))

p3 <- ggplot(datos_horarios_aire, aes(x = as.factor(HORA), y = PM10)) +
  geom_boxplot(width = 0.4, color = "black", fill = colores["PM10"], alpha = 0.7) +
  scale_y_continuous(limits = quantile(datos_horarios_aire$SO2, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  PM10") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 10, b = -20))) + 
  labs(x = "Mes", y = bquote(μg / m^3))

p4 <- ggplot(datos_horarios_aire, aes(x = as.factor(HORA), y = PM25)) +
  geom_boxplot(width = 0.4, color = "black", fill = colores["PM25"], alpha = 0.7) +
  scale_y_continuous(limits = quantile(datos_horarios_aire$SO2, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  PM25") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 10, b = -20))) + 
  labs(x = "Mes", y = bquote(μg / m^3))

p5 <- ggplot(datos_horarios_aire, aes(x = as.factor(HORA), y = O3)) +
  geom_boxplot(width = 0.4, color = "black", fill = colores["O3"], alpha = 0.7) +
  scale_y_continuous(limits = quantile(datos_horarios_aire$SO2, c(0.1, 0.9), na.rm = TRUE)) +
  ggtitle("  O3") +
  theme_bw() + 
  theme(axis.text = element_text(size = 8), axis.title =  element_text(size = 9), plot.title = element_text(face = 'bold', margin = margin(t = 10, b = -20))) + 
  labs(x = "Mes", y = bquote(μg / m^3))

```

```{r message= FALSE, warning=FALSE}

p <- plot_grid(p1, p2, p3, p4, p5, ncol = 2)
save_plot("prueba5.png", p, base_width = 10, base_height = 8)

```

